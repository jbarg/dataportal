<project name="myproxy" default="dist" basedir=".">
	<description>
        simple example build file
    </description>
	<!-- set global properties for this build -->
	<property name="src" location="src"/>
	<property name="build" location="build"/>
	<property name="dist" location="dist"/>
	<property name="lib" location="lib"/>
	<property name="conf" location="conf"/>
	<target name="run" depends="jar">
	<move file="${dist}/Proxy.jar" tofile="${lib}/Proxy.jar"/>

        
		<java jar="${lib}/Proxy.jar" fork="true">
			<classpath refid="compile.classpath"/>
		</java>
	</target>
	
		<target name="runnb" depends="getClasspath">

		<java jar="${lib}/Proxy.jar" fork="true">
			<classpath refid="compile.classpath"/>
		</java>
	</target>
	
	
	<target name="init">
		<!-- Create the time stamp -->
		<tstamp/>
		<!-- <delete dir="${build}" />-->
		<!-- Create the build directory structure used by compile -->
		<mkdir dir="${build}"/>
                <mkdir dir="${build}/img"/>
	</target>
	<target name="compile" depends="init, getClasspath" description="compile the source">
		<!-- Compile the java code from ${src} into ${build} -->
		<javac srcdir="${src}" destdir="${build}">
			<classpath refid="compile.classpath"/>
		</javac>
		<copy file="${conf}/01621954.0" tofile="${build}/01621954.0"/>
		<copy file="${conf}/versionNotes" tofile="${build}/uk/ac/dl/myproxy/versionNotes"/>
		<copy file="${conf}/help.html" tofile="${build}/uk/ac/dl/myproxy/help.html"/>
		<copy file="${conf}/version.txt" tofile="${build}/uk/ac/dl/myproxy/version.txt"/>
              
                <copy todir="${build}/img">
                <fileset dir="${conf}/img"/>
                </copy>
	</target>
	<target name="javadoc" depends="init, getClasspath" description="compile the source ">
		<javadoc packagenames="*" sourcepath="src" defaultexcludes="yes" destdir="docs/api" use="true" windowtitle="Test API">
			<classpath refid="compile.classpath"/>
		</javadoc>
	</target>
	<target name="jar" depends="compile" description="generate the distribution">
		<!-- Create the distribution directory -->
		<mkdir dir="${dist}/lib"/>
		<!-- Put everything in ${build} into the MyProject-${DSTAMP}.jar file -->
		<!--<jar jarfile="${dist}/lib/Proxy.jar" basedir="${build}" manifest="${conf}/MANIFEST.MF" includes="${build}/uk/ac/dl/myproxy/version.txt,${build}/01621954.0,${build}/uk/ac/dl/myproxy/help.html,${build}/uk/ac/dl/myproxy/versionNotes"/>-->
		<jar jarfile="${dist}/lib/Proxy.jar" basedir="${build}" manifest="${conf}/MANIFEST.MF" />
		
               <move file="${dist}/lib/Proxy.jar" tofile="${dist}/Proxy.jar">
			
		</move>
		
	</target>
	<target name="dist" depends="jar">
		<delete includeEmptyDirs="true">
			<fileset dir="${build}"/>
		</delete>
	</target>
	<target name="getClasspath">
		<path id="compile.classpath">
			<fileset dir="${lib}">
				<include name="*.jar"/>
			</fileset>
		</path>
	</target>
	<target name="sign" depends="jar">
		<!--	<property name="keystore.password" value="changeit"/>
		<echo message="${java.home}"/>-->
		<input message="Enter keystore password:" addproperty="keystore.password"/>
		<condition property="do.abort">
			<equals arg1="${keystore.password}" arg2=""/>
		</condition>
		<fail if="do.abort">Build aborted by user.  Keystore requires a password.</fail>
		<move file="${dist}/Proxy.jar" tofile="${lib}/Proxy.jar"/>

		<echo message="${java.home}/jarsigner -keystore '${conf}/keystore' -storepass ${keystore.password} '${dist}/lib/Proxy.jar' DataPortal"/>
		<exec dir="${java.home}" executable="jarsigner">
			<arg line="-keystore '${conf}/keystore' -storepass ${keystore.password} '${lib}/Proxy.jar' DataPortal"/>
				</exec>
				
					</target>
					
			<target name="runsigned">
			
			<java jar="${lib}/Proxy.jar" fork="true">
			<classpath refid="compile.classpath"/>
		</java>

			
			</target>
		
                        
    <target name="scpimg" >
   <!-- <input message="Enter tiber password:" addproperty="tiber.password"/>
    <condition property="do.abort">
            <equals arg1="${tiber.password}" arg2=""/>
    </condition>
    <fail if="do.abort">Build aborted by user.  scp requires a password.</fail>
    <exec dir="/usr/bin" executable="scp">
            <arg line="-keystore '${conf}/keystore' -storepass ${keystore.password} '${lib}/Proxy.jar' DataPortal"/>
    </exec>-->
<echo message="scp conf/img/*.* tomcat4@tiber.dl.ac.uk:webapps/myproxy/img/"/>
    </target>
    
    <target name="scpproxy" >
   <!-- <input message="Enter tiber password:" addproperty="tiber.password"/>
    <condition property="do.abort">
            <equals arg1="${tiber.password}" arg2=""/>
    </condition>
    <fail if="do.abort">Build aborted by user.  scp requires a password.</fail>
    <exec dir="/usr/bin" executable="scp">
            <arg line="-keystore '${conf}/keystore' -storepass ${keystore.password} '${lib}/Proxy.jar' DataPortal"/>
    </exec>-->
<echo message="scp lib/Proxy.jar tomcat4@tiber.dl.ac.uk:webapps/myproxy/."/>
    </target>
    
    <target name="scphelp" >
   <!-- <input message="Enter tiber password:" addproperty="tiber.password"/>
    <condition property="do.abort">
            <equals arg1="${tiber.password}" arg2=""/>
    </condition>
    <fail if="do.abort">Build aborted by user.  scp requires a password.</fail>
    <exec dir="/usr/bin" executable="scp">
            <arg line="-keystore '${conf}/keystore' -storepass ${keystore.password} '${lib}/Proxy.jar' DataPortal"/>
    </exec>-->
<echo message="scp conf/Help_tiber.html conf/index.html conf/mainmenu.css conf/data.cer tomcat4@tiber.dl.ac.uk:webapps/myproxy/."/>
    </target>
					
</project>
