# Makefile - This is the main makefile for the SRB software

include ../../mk/mk.config
include ../../mk/mk.common

exampleSrcDir=src
binDir=bin
objDir=obj
libDir=../../obj

vpath %.c $(exampleSrcDir)

CL_CFLAGS+=$(MY_CFLAG)

CL_CFLAGS+= -I../../src/include

CL_CFLAGS+= -I../../src/catalog/include

CL_LDADD=$(LDADD)
CL_LDADD+=-L$(libDir) -lSrbClient

# SGI doesn't like -lm in the middle of the CC line
ifeq ($(PORTNAME), PORTNAME_osx)
else
ifeq ($(PORTNAME), PORTNAME_sgi)
else
LDADD+=-lm
endif
endif

ifdef PARA_OPR
LDADD+=-lpthread
endif

EXOBJ = $(objDir)/sconnect.o \
$(objDir)/sput.o $(objDir)/sget.o $(objDir)/sreplicate.o	\
$(objDir)/sgetcopy.o $(objDir)/sstat.o $(objDir)/squery.o \
$(objDir)/sgetdents.o $(objDir)/slock.o

EXAMBIN = $(binDir)/sconnect  \
$(binDir)/sput $(binDir)/sget $(binDir)/sreplicate $(binDir)/sgetcopy	\
$(binDir)/sstat $(binDir)/squery $(binDir)/sgetdents $(binDir)/slock

TARGETS:= $(EXAMBIN)

all:: $(TARGETS)
	test -d obj || mkdir obj
	test -d src || mkdir src

clean:
	rm -f $(TARGETS) $(EXOBJ)
 
$(EXOBJ): $(objDir)/%.o: %.c
	$(CC) -g -c $(CL_CFLAGS) -o $@ $<

$(EXAMBIN): $(binDir)/%: $(objDir)/%.o
	$(CC) -o $@ $^ $(CL_LDADD)
